{# app/templates/api_football/data_import.html #}
{% extends 'base.html' %}

{% block title %}API-Football - Importation de données{% endblock %}

{% block content %}
<div class="container py-4">
    <h1 class="mb-4">Importation de données depuis API-Football</h1>
    
    <div class="card mb-4">
        <div class="card-header bg-primary text-white">
            <h2 class="h5 mb-0">Formulaire d'importation</h2>
        </div>
        <div class="card-body">
            <form method="POST" action="{{ url_for('api_football.data_import') }}">
                <div class="mb-3">
                    <label for="import_type" class="form-label">Type de données</label>
                    <select class="form-select" id="import_type" name="import_type" required>
                        <option value="">Sélectionner un type</option>
                        <option value="teams">Équipes</option>
                        <option value="players">Joueurs</option>
                        <option value="fixtures">Matchs</option>
                        <option value="statistics">Statistiques</option>
                    </select>
                </div>
                
                <div id="league_container" class="mb-3">
                    <label for="league_id" class="form-label">Ligue</label>
                    <select class="form-select" id="league_id" name="league_id">
                        <option value="">Sélectionner une ligue (optionnel)</option>
                        {% for league in leagues %}
                        <option value="{{ league.id }}">{{ league.name }} ({{ league.country }})</option>
                        {% endfor %}
                    </select>
                </div>
                
                <div id="team_container" class="mb-3" style="display: none;">
                    <label for="team_id" class="form-label">Équipe</label>
                    <input type="text" class="form-control" id="team_id" name="team_id" placeholder="ID de l'équipe">
                    <div class="form-text">Importation des joueurs ou matchs pour une équipe spécifique.</div>
                </div>
                
                <div class="mb-3">
                    <label for="season" class="form-label">Saison</label>
                    <select class="form-select" id="season" name="season">
                        <option value="">Sélectionner une saison (optionnel)</option>
                        <option value="2024">2024</option>
                        <option value="2023">2023</option>
                        <option value="2022">2022</option>
                        <option value="2021">2021</option>
                        <option value="2020">2020</option>
                    </select>
                </div>
                
                <div class="mb-3">
                    <label class="form-label">Planification</label>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="schedule_type" id="schedule_now" value="now" checked>
                        <label class="form-check-label" for="schedule_now">
                            Exécuter maintenant
                        </label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="schedule_type" id="schedule_once" value="once">
                        <label class="form-check-label" for="schedule_once">
                            Planifier pour une date spécifique
                        </label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="schedule_type" id="schedule_recurring" value="recurring">
                        <label class="form-check-label" for="schedule_recurring">
                            Planifier de manière récurrente
                        </label>
                    </div>
                </div>
                
                <div id="once_options" class="mb-3" style="display: none;">
                    <label for="execution_date" class="form-label">Date et heure d'exécution</label>
                    <input type="datetime-local" class="form-control" id="execution_date" name="execution_date">
                </div>
                
                <div id="recurring_options" class="mb-3" style="display: none;">
                    <div class="row">
                        <div class="col-md-6">
                            <label for="recurrence_pattern" class="form-label">Motif de récurrence</label>
                            <select class="form-select" id="recurrence_pattern" name="recurrence_pattern">
                                <option value="daily">Quotidien</option>
                                <option value="weekly">Hebdomadaire</option>
                                <option value="monthly">Mensuel</option>
                            </select>
                        </div>
                        <div class="col-md-6" id="day_of_week_container" style="display: none;">
                            <label for="day_of_week" class="form-label">Jour de la semaine</label>
                            <select class="form-select" id="day_of_week" name="day_of_week">
                                <option value="0">Dimanche</option>
                                <option value="1">Lundi</option>
                                <option value="2">Mardi</option>
                                <option value="3">Mercredi</option>
                                <option value="4">Jeudi</option>
                                <option value="5">Vendredi</option>
                                <option value="6">Samedi</option>
                            </select>
                        </div>
                        <div class="col-md-6" id="day_of_month_container" style="display: none;">
                            <label for="day_of_month" class="form-label">Jour du mois</label>
                            <select class="form-select" id="day_of_month" name="day_of_month">
                                {% for day in range(1, 29) %}
                                <option value="{{ day }}">{{ day }}</option>
                                {% endfor %}
                            </select>
                        </div>
                    </div>
                    <div class="mt-3">
                        <label for="start_date" class="form-label">Date de début</label>
                        <input type="date" class="form-control" id="start_date" name="start_date">
                    </div>
                </div>
                
                <div class="alert alert-info">
                    <div class="d-flex align-items-center">
                        <div class="me-3">
                            <i class="bi bi-info-circle-fill fs-3"></i>
                        </div>
                        <div>
                            <h5 class="alert-heading">Quota d'API</h5>
                            <p class="mb-0">Cette importation utilisera au moins une requête API. Vous disposez actuellement de <strong>{{ remaining }} requêtes</strong> restantes pour aujourd'hui.</p>
                        </div>
                    </div>
                </div>
                
                <div class="d-grid gap-2">
                    <button type="submit" class="btn btn-primary">
                        <i class="bi bi-cloud-download me-2"></i>Importer les données
                    </button>
                    <a href="{{ url_for('api_football.index') }}" class="btn btn-secondary">Annuler</a>
                </div>
            </form>
        </div>
    </div>
    
    <div class="card mb-4">
        <div class="card-header bg-primary text-white">
            <h2 class="h5 mb-0">Ligues disponibles</h2>
        </div>
        <div class="card-body">
            <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
                {% for league in leagues %}
                <div class="col">
                    <div class="card h-100">
                        <div class="card-body">
                            <div class="d-flex align-items-center mb-3">
                                {% if league.logo %}
                                <img src="{{ league.logo }}" alt="{{ league.name }}" class="me-3" style="width: 40px; height: 40px; object-fit: contain;">
                                {% else %}
                                <div class="bg-light rounded d-flex align-items-center justify-content-center me-3" style="width: 40px; height: 40px;">
                                    <i class="bi bi-trophy"></i>
                                </div>
                                {% endif %}
                                <h5 class="card-title mb-0">{{ league.name }}</h5>
                            </div>
                            <p class="card-text">{{ league.country }}</p>
                            <p class="card-text">ID: {{ league.id }}</p>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
</div>

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Gestion des options de planification
    const scheduleNow = document.getElementById('schedule_now');
    const scheduleOnce = document.getElementById('schedule_once');
    const scheduleRecurring = document.getElementById('schedule_recurring');
    const onceOptions = document.getElementById('once_options');
    const recurringOptions = document.getElementById('recurring_options');
    
    scheduleNow.addEventListener('change', function() {
        if (this.checked) {
            onceOptions.style.display = 'none';
            recurringOptions.style.display = 'none';
        }
    });
    
    scheduleOnce.addEventListener('change', function() {
        if (this.checked) {
            onceOptions.style.display = 'block';
            recurringOptions.style.display = 'none';
        }
    });
    
    scheduleRecurring.addEventListener('change', function() {
        if (this.checked) {
            onceOptions.style.display = 'none';
            recurringOptions.style.display = 'block';
        }
    });
    
    // Gestion des options de récurrence
    const recurrencePattern = document.getElementById('recurrence_pattern');
    const dayOfWeekContainer = document.getElementById('day_of_week_container');
    const dayOfMonthContainer = document.getElementById('day_of_month_container');
    
    recurrencePattern.addEventListener('change', function() {
        if (this.value === 'weekly') {
            dayOfWeekContainer.style.display = 'block';
            dayOfMonthContainer.style.display = 'none';
        } else if (this.value === 'monthly') {
            dayOfWeekContainer.style.display = 'none';
            dayOfMonthContainer.style.display = 'block';
        } else {
            dayOfWeekContainer.style.display = 'none';
            dayOfMonthContainer.style.display = 'none';
        }
    });
    
    // Afficher le champ d'équipe uniquement pour les types d'importation appropriés
    const importType = document.getElementById('import_type');
    const teamContainer = document.getElementById('team_container');
    
    importType.addEventListener('change', function() {
        if (this.value === 'players' || this.value === 'fixtures') {
            teamContainer.style.display = 'block';
        } else {
            teamContainer.style.display = 'none';
        }
    });
});
</script>
{% endblock %}
{% endblock %}